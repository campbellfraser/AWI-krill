krill$date.YMD = as.character(janitor::excel_numeric_to_date(krill$Date))
usableKrill = dplyr::filter(krill,Weight<4|Size<60)
hist(usableKrill$Size)
krill$Size>70
krill$Size<70
usableKrill = dplyr::filter(krill,Weight<4|Size<60) # Removes the weirdly large weights
usableKrill = dplyr::filter(krill,Weight<(4,na.rm=TRUE)|Size<(70,na.rm=TRUE)) # Removes the weirdly large weights
usableKrill = dplyr::filter(krill,Weight<4|Size<70) # Removes the weirdly large weights
usableKrill = dplyr::filter(krill,Size<70) # Removes the weirdly large weights
usableKrill = dplyr::filter(krill,Size<70|Weight<4) # Removes the weirdly large weights
usableKrill = dplyr::filter(krill,Size<70 xor Weight<4) # Removes the weirdly large weights
usableKrill = dplyr::filter(krill,Size<70||Weight<4) # Removes the weirdly large weights
usableKrill = dplyr::filter(krill,Size<70|Weight<4) # Removes the weirdly large weights
usableKrill = dplyr::filter(krill,Size<70)
usableKrill = dplyr::filter(usableKrill,Weight<4)
hist(usableKrill$Size)
usableKrill = dplyr::filter(usableKrill,Size!=0)
usableKrill = dplyr::filter(krill,Size<70,Weight<4,Size!=0)
shapiro.test(usableKrill$Weight)
hist(usableKrill$Weight)
hist(usableKrill$Size)
usableKrill = dplyr::filter(krill,1<Size<70,Weight<4)
usableKrill = dplyr::filter(krill,Size>1,Size<70,Weight<4)
hist(usableKrill$Weight)
hist(usableKrill$Size)
hist(usableKrill$Weight)
usableKrill = dplyr::filter(krill,Size>1,Size<70,Weight<3)
hist(usableKrill$Weight)
hist(usableKrill$Size)
shapiro.test(usableKrill$Weight)
shapiro.test(usableKrill$Size)
shapiro.test(log10(usableKrill$Weight))
shapiro.test(log10(usableKrill$Size))
require(car)
shapiro.test(transformTukey(usableKrill$Weight))
am.size = lm(Lipids~Weight, data=usableKrill)
am.weight = lm(Lipids~Weight, data=usableKrill)
remove(am.size)
plot(am.weight)
par(mfrow=c(2,2))
am.weight = lm(Lipids~Weight, data=usableKrill)
plot(am.weight)
shapiro.test(am.weight)
shapiro.test(Lipids~Weight, data=usableKrill)
with(usableKrill, shapiro.test(Lipids~Weight))
shapiro.test(usableKrill$Lipids~usableKrill$Weight))
shapiro.test(usableKrill$Lipids~usableKrill$Weight)
class(usableKrill$Lipids)
class(usableKrill$Weight)
shapiro.test(usableKrill$Lipids)
shapiro.test(usableKrill$Weight)
# These are both continuous variables, so I should do a linear regression model
# I have forgotten how to do a linear regression model...
require(car)
car::ncvTest(am.weight)
install.packages("caret")
# These are both continuous variables, so I should do a linear regression model
# I have forgotten how to do a linear regression model...
require(pacman)
pacman::p_load(car,caret)
LipidsBC = caret::BoxCoxTrans(usableKrill$Lipids)
WeightBC = caret::BoxCoxTrans(usableKrill$Weight)
usableKrill = cbind(usableKrill, transLipids=predict(LipidsBC,usableKrill$Lipids))
View(usableKrill)
with(usableKrill, plot(Weight~Lipids))
View(usableKrill)
usableKrill = dplyr::filter(krill,Size>1,Size<70,Weight<3,Lipids>0) # Remove anomalous results
with(usableKrill, plot(Weight~Lipids))
View(krill)
testData = read.xlsx2("testData.xlsx",sheetIndex=1)
require(pacman)
pacman::p_load(ggplot2,dplyr,forcats,xlsx,cowplot,janitor,lubridate,colorspace,stringi,scales,ggrepel)
testData = read.xlsx2("testData.xlsx",sheetIndex=1)
testData = read.xlsx2("testData.xlsx",sheetIndex=1)
ggplot(testData,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity")
ggplot(testData,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",beside=TRUE)
ggplot(testData,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge")
testData$Lipids = as.numeric(testData$Lipids)
ggplot(testData,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge")
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1)
krill = rename(krill, Lipids=GasChromatography_FattyAcidProfile_TotalPUFA_Omega3)
krill = rename(krill, Weight=RawKrill_Weight_g)
krill = rename(krill, Size=RawKrill_Size_mm)
krill[c("Date","Lipids","Size","Weight")] = sapply(krill[c("Date","Lipids","Size","Weight")],as.numeric)
krill$date.YMD = as.character(janitor::excel_numeric_to_date(krill$Date))
years = c('2011','2012','2013','2014','2015','2016','2017','2018','2019','2020','2021')
month.abb(6)
month(5)
month(05)
month("2021-12-20")
month("2021-12-20",abbr = TRUE)
month("2021-12-20",abbr = FALSE)
month("2021-12-20")
i="2017"
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD))
View(krillYEAR)
krillJUL = dplyr::filter(krillYEAR,grepl("07",date.YMD))
View(krillJUL)
krillJUL = dplyr::filter(krillYEAR,grepl("-07-",date.YMD))
View(krillJUL)
krillAUG = dplyr::filter(krillYEAR,grepl("-08-",date.YMD))
seasonalLipids = data.frame()
years = c('2011','2012','2013','2014','2015','2016','2017','2018','2019','2020','2021')
remove(krillYEAR)
remove(krillJUL)
remove(krillAUG)
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
krillJUL = dplyr::filter(krillYEAR,grepl("-07-",date.YMD))
krillAUG = dplyr::filter(krillYEAR,grepl("-08-",date.YMD))
JULsum = sum(krillJUL$Lipids,na.rm=TRUE)
AUGsum = sum(krillAUG$Lipids,na.rm=TRUE)
seasonalLipids = rbind(seasonalLipids,c(i,JULsum,"July"))
seasonalLipids = rbind(seasonalLipids,c(i,AUGsum,"August"))
}
View(seasonalLipids)
seasonalLipids = data.frame(matrix(ncol=3,nrow=0, dimnames=list(NULL,c("Year","Lipids","Month"))))
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
krillJUL = dplyr::filter(krillYEAR,grepl("-07-",date.YMD))
krillAUG = dplyr::filter(krillYEAR,grepl("-08-",date.YMD))
JULsum = sum(krillJUL$Lipids,na.rm=TRUE)
AUGsum = sum(krillAUG$Lipids,na.rm=TRUE)
seasonalLipids = rbind(seasonalLipids,c(i,JULsum,"July"))
seasonalLipids = rbind(seasonalLipids,c(i,AUGsum,"August"))
}
seasonalLipids = data.frame()
colnames(seasonalLipids) = c("Year","Lipids","Month")
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
krillJUL = dplyr::filter(krillYEAR,grepl("-07-",date.YMD))
krillAUG = dplyr::filter(krillYEAR,grepl("-08-",date.YMD))
JULsum = sum(krillJUL$Lipids,na.rm=TRUE)
AUGsum = sum(krillAUG$Lipids,na.rm=TRUE)
seasonalLipids = rbind(seasonalLipids,c(i,JULsum,"July"))
seasonalLipids = rbind(seasonalLipids,c(i,AUGsum,"August"))
}
colnames(seasonalLipids) = c("Year","Lipids","Month")
seasonalLipids$Lipids = as.numeric(seasonalLipids$Lipids)
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge")
krillCocktail
View(krillAUG)
View(krillYEAR)
length(krillAUG)
length(krillAUG$date.YMD)
seasonalLipids = data.frame()
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
krillJUL = dplyr::filter(krillYEAR,grepl("-07-",date.YMD))
JULsum = sum(krillJUL$Lipids,na.rm=TRUE)
JULmean = JULsum/length(krillJUL$date.YMD)
krillAUG = dplyr::filter(krillYEAR,grepl("-08-",date.YMD))
AUGsum = sum(krillAUG$Lipids,na.rm=TRUE)
AUGmean = AUGsum/length(krillAUG$date.YMD)
seasonalLipids = rbind(seasonalLipids,c(i,JULmean,"July"))
seasonalLipids = rbind(seasonalLipids,c(i,AUGmean,"August"))
}
colnames(seasonalLipids) = c("Year","Lipids","Month")
seasonalLipids$Lipids = as.numeric(seasonalLipids$Lipids)
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge")
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
labs(x="Mean Omega-3 Content (mg)")
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
labs(y="Mean Omega-3 Content (mg)")
krillCocktail
seasonalLipids$Month = as.factor(seasonalLipids$Month)
seasonalLipids$Month
seasonalLipids$Month %>% . = relevel(.,"July")
seasonalLipids$Month %>% relevel("July")
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
ggtitle("Omega-3 Content of Krill Stomachs Every July") +
labs(y="Mean Omega-3 Content (mg)")
krillCocktail
View(seasonalLipids)
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)")
krillCocktail
month(krillAUG$date.YMD)
month(krillAUG$date.YMD[1])
seasonalLipids = data.frame()
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
krillJUL = dplyr::filter(krillYEAR,grepl("-07-",date.YMD))
JULsum = sum(krillJUL$Lipids,na.rm=TRUE)
JULmean = JULsum/length(krillJUL$date.YMD)
krillAUG = dplyr::filter(krillYEAR,grepl("-08-",date.YMD))
AUGsum = sum(krillAUG$Lipids,na.rm=TRUE)
AUGmean = AUGsum/length(krillAUG$date.YMD)
seasonalLipids = rbind(seasonalLipids,c(i,JULmean,as.character(month(krillJUL$date.YMD[1]))))
seasonalLipids = rbind(seasonalLipids,c(i,AUGmean,as.character(month(krillAUG$date.YMD[1]))))
}
colnames(seasonalLipids) = c("Year","Lipids","Month")
seasonalLipids$Month = as.factor(seasonalLipids$Month)
seasonalLipids$Lipids = as.numeric(seasonalLipids$Lipids)
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)")
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
sd(krillJUL$Lipids)
View(krillJUL)
sd(krillJUL$Lipids,na.rm=TRUE)
seasonalLipids = data.frame()
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
JULkrill = dplyr::filter(krillYEAR,grepl("-07-",date.YMD))
JULsum = sum(JULkrill$Lipids,na.rm=TRUE)
JULmean = JULsum/length(JULkrill$date.YMD)
JULsd = sd(JULkrill$Lipids,na.rm=TRUE)
AUGkrill = dplyr::filter(krillYEAR,grepl("-08-",date.YMD))
AUGsum = sum(AUGkrill$Lipids,na.rm=TRUE)
AUGmean = AUGsum/length(AUGkrill$date.YMD)
AUGsd = sd(AUGkrill$Lipids,na.rm=TRUE)
seasonalLipids = rbind(seasonalLipids,c(i,JULmean,as.character(month(JULkrill$date.YMD[1])),JULsd))
seasonalLipids = rbind(seasonalLipids,c(i,AUGmean,as.character(month(AUGkrill$date.YMD[1])),AUGsd))
}
View(seasonalLipids)
colnames(seasonalLipids) = c("Year","Lipids","Month","SD")
seasonalLipids$Month %<% as.factor(Month)
seasonalLipids$Month %>% as.factor(Month)
seasonalLipids$Month %>% as.factor()
seasonalLipids$Month %>% as.factor()
seasonalLipids$Month = as.factor(seasonalLipids$Month)
seasonalLipids$Lipids %<% Lipids = as.numeric()
seasonalLipids$Lipids %>% Lipids = as.numeric()
seasonalLipids$Lipids = as.numeric(seasonalLipids$Lipids)
with(seasonalLipids,
Month=as.factor(Month),
Lipids=as.numeric(Lipids))
with(seasonalLipids,
Month=as.factor(),
Lipids=as.numeric())
seasonalLipids$SD = as.numeric(seasonalLipids$SD)
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
geom_errorbar(aes(ymin=Lipids-SD,ymax=Lipids+SD),position="dodge",width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
geom_errorbar(aes(ymin=Lipids-SD,ymax=Lipids+SD),position=position_dodge(0.5),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
geom_errorbar(aes(ymin=Lipids-SD,ymax=Lipids+SD),position=position_dodge(1),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position="dodge") +
geom_errorbar(aes(ymin=Lipids-SD,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
geom_errorbar(aes(ymin=Lipids-SD,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
View(seasonalLipids)
krill_pal = hue_pal()(12)
krill_pal(7,8)
krill_pal[7,8]
krill_pal(7)
krill_pal[7]
krill_pal[8]
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
geom_jitter(position=position_jitterdodge(jitter.width=0.2,dodge.width=0.9)) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
,fill=Month
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_manual(values=c("#00BFC4","#00B4F0")) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"),values=c("#00BFC4","#00B4F0"))
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_manual(values=c("#00BFC4","#00B4F0")) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)") +
scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_manual(values=c("#00BFC4","#00B4F0")) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)")
#  scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_manual(values=c("#00BFC4","#00B4F0"),labels=c("July","August")) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)")
#  scale_fill_discrete(name="Month",labels=c("July","August"))
krillCocktail
i="2018"
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1) #Load the data
krill = rename(krill, Lipids=GasChromatography_FattyAcidProfile_TotalPUFA_Omega3) #Rename the lipid variable to something not so insanely long
krill$Lipids = as.numeric(krill$Lipids) #Turn the lipid variable into integers
krill$Date = as.numeric(krill$Date) #Turn the date into a number
#But this is an issue... since the dates are in the 1900 Excel format
krill$date.YMD = as.character(janitor::excel_numeric_to_date(krill$Date)) #Convert the dates to a recognisable format using janitor package
years = c('2011','2012','2013','2014','2015','2016','2017','2018','2019','2020','2021')
allMonths = c("J","F","M","A","M","J","J","A","S","O","N","D")
monthNums = c("01","02","03","04","05","06","07","08","09","10","11","12")
# Looop! ####
for (i in years){
print(i)
krill_pal = hue_pal()(12)
remove(krillYEAR,krillPie,tempMonth,labelPos)
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD))
for (j in krillYEAR$date.YMD){
krillYEAR$specMonth=(stri_sub(krillYEAR$date.YMD,6,7))
monthlyLipids = data.frame()
badMonth = c()
n=1
for (u in monthNums){
tempMonth = dplyr::filter(krillYEAR,grepl(u,specMonth))
monthSum = sum(tempMonth$Lipids,na.rm=TRUE)
monthMean = monthSum/length(tempMonth$specMonth)
if (((is.nan(monthMean)==TRUE|(monthMean==0)==TRUE))==TRUE){ # Surely there's an easier way to do this? Oh well...
monthlyLipids = rbind(monthlyLipids,c(0,u,i))
krill_pal[as.numeric(u)] = "#454545"
badMonth[n] = as.numeric(u)
n=n+1
} else {
monthlyLipids = rbind(monthlyLipids,c(monthMean,u,i))}
}
colnames(monthlyLipids) = c("lipidMean","Month","Year")
monthlyLipids$lipidMean = as.numeric(monthlyLipids$lipidMean)
monthlyLipids$Month = as.factor(monthlyLipids$Month)
monthlyLipids$Year = as.character(monthlyLipids$Year)
labelPos = monthlyLipids %>%
mutate(csum = rev(cumsum(rev(lipidMean))),
pos = lipidMean/2 + lead(csum, 1),
pos = if_else(is.na(pos), lipidMean/2, pos,))
labelPos$pos[badMonth] = NA
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",
width=1,
color="white") +
coord_polar("y",start=0,direction=-1,clip="off") +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
geom_label_repel(labelPos, mapping=aes(y=pos, label=paste0(round(lipidMean,digits=2),"mg")),
size = 6.5, nudge_x = 0.7, show.legend = FALSE, na.rm = TRUE) +
ggtitle(i,subtitle=paste(as.character(round((sum(krillYEAR$Lipids,na.rm=TRUE)/1000),digits=2)), "g total")) + theme(plot.title = element_text(size = 22, face = "bold"), plot.subtitle = element_text(size = 19.5), legend.key.height=unit(0.5,"cm"),legend.title=element_text(size=18,face="bold"),legend.text=element_text(size=17))
assign(paste0("krill",i),krillPie)
}
}
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1) #Load the data
krill = rename(krill, Lipids=GasChromatography_FattyAcidProfile_TotalPUFA_Omega3) #Rename the lipid variable to something not so insanely long
krill$Lipids = as.numeric(krill$Lipids) #Turn the lipid variable into integers
krill$Date = as.numeric(krill$Date) #Turn the date into a number
#But this is an issue... since the dates are in the 1900 Excel format
krill$date.YMD = as.character(janitor::excel_numeric_to_date(krill$Date)) #Convert the dates to a recognisable format using janitor package
years = c('2011','2012','2013','2014','2015','2016','2017','2018','2019','2020','2021')
allMonths = c("J","F","M","A","M","J","J","A","S","O","N","D")
monthNums = c("01","02","03","04","05","06","07","08","09","10","11","12")
years="2018"
# Looop! ####
for (i in years){
print(i)
krill_pal = hue_pal()(12)
remove(krillYEAR,krillPie,tempMonth,labelPos)
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD))
for (j in krillYEAR$date.YMD){
krillYEAR$specMonth=(stri_sub(krillYEAR$date.YMD,6,7))
monthlyLipids = data.frame()
badMonth = c()
n=1
for (u in monthNums){
tempMonth = dplyr::filter(krillYEAR,grepl(u,specMonth))
monthSum = sum(tempMonth$Lipids,na.rm=TRUE)
monthMean = monthSum/length(tempMonth$specMonth)
if (((is.nan(monthMean)==TRUE|(monthMean==0)==TRUE))==TRUE){ # Surely there's an easier way to do this? Oh well...
monthlyLipids = rbind(monthlyLipids,c(0,u,i))
krill_pal[as.numeric(u)] = "#454545"
badMonth[n] = as.numeric(u)
n=n+1
} else {
monthlyLipids = rbind(monthlyLipids,c(monthMean,u,i))}
}
colnames(monthlyLipids) = c("lipidMean","Month","Year")
monthlyLipids$lipidMean = as.numeric(monthlyLipids$lipidMean)
monthlyLipids$Month = as.factor(monthlyLipids$Month)
monthlyLipids$Year = as.character(monthlyLipids$Year)
labelPos = monthlyLipids %>%
mutate(csum = rev(cumsum(rev(lipidMean))),
pos = lipidMean/2 + lead(csum, 1),
pos = if_else(is.na(pos), lipidMean/2, pos,))
labelPos$pos[badMonth] = NA
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",
width=1,
color="white") +
coord_polar("y",start=0,direction=-1,clip="off") +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
geom_label_repel(labelPos, mapping=aes(y=pos, label=paste0(round(lipidMean,digits=2),"mg")),
size = 6.5, nudge_x = 0.7, show.legend = FALSE, na.rm = TRUE) +
ggtitle(i,subtitle=paste(as.character(round((sum(krillYEAR$Lipids,na.rm=TRUE)/1000),digits=2)), "g total")) + theme(plot.title = element_text(size = 22, face = "bold"), plot.subtitle = element_text(size = 19.5), legend.key.height=unit(0.5,"cm"),legend.title=element_text(size=18,face="bold"),legend.text=element_text(size=17))
assign(paste0("krill",i),krillPie)
}
}
krill2018
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_discrete(labels=c("July","August")) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)")
krillCocktail
krillCocktail
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_discrete(labels=c("July","August")) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)")
# 14/09/2022 | Pie charts for each year to illustrate mean monthly lipid content
#Prerequisites ####
require(pacman)
pacman::p_load(ggplot2,dplyr,forcats,xlsx,cowplot,janitor,lubridate,colorspace,stringi,scales,ggrepel)
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_discrete(labels=c("July","August")) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Omega-3 Content of Krill Stomachs July/August") +
labs(y="Mean Omega-3 Content (mg)")
krillCocktail
