#AUGsd = sd(AUGkrill$Lipids,na.rm=TRUE)
#seasonalLipids = rbind(seasonalLipids,c(i,JULmean,as.character(month(JULkrill$date.YMD[1])),JULsd))
#seasonalLipids = rbind(seasonalLipids,c(i,AUGmean,as.character(month(AUGkrill$date.YMD[1])),AUGsd))
}
colnames(seasonalLipids) = c("Year","Lipids","Month","SD")
seasonalLipids$Lipids = as.numeric(seasonalLipids$Lipids)
seasonalLipids$Month = as.factor(seasonalLipids$Month)
seasonalLipids$SD = as.numeric(seasonalLipids$SD)
seasonalLipids[seasonalLipids==0] = NA
month(09)
month("09")
month(09,abbr=FALSE)
month(09,abbr=TRUE)
allMonthsLong = c("January","February","March","April","May","June","July","August","September","October","November","December")
allMonthsLong[as.numeric(inspectaMonth)]
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_discrete(labels=allMonthsLong[as.numeric(inspectaMonth)]) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Mean omega-3 Content of Krill Stomachs June/July/August/September") +
labs(y="Mean Omega-3 Content (mg)")
krillCocktail
inspectaMonth = readline(prompt="Months: ")
inspectaMonth = strsplit(str,"[[:space:]]")
inspectaMonth = strsplit(inspectaMonth,"[[:space:]]")
inspectaMonth = c("06","07","08","09")
inspectaMonth
inspectaMonth = readline(prompt="Months: ")
inspectaMonth = strsplit(inspectaMonth,"[[:space:]]")
inspectaMonth
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
for (j in inspectaMonth){
MONTHkrill = dplyr::filter(krillYEAR,grepl(paste0("-",j,"-"),date.YMD))
MONTHsum = sum(MONTHkrill$Lipids,na.rm=TRUE)
MONTHmean = MONTHsum/length(MONTHkrill$date.YMD)
MONTHsd = sd(MONTHkrill$Lipids,na.rm=TRUE)
seasonalLipids = rbind(seasonalLipids,c(i,MONTHmean,j,MONTHsd))
}
}
warnings()
View(seasonalLipids)
seasonalLipids = data.frame()
inspectaMonth = readline(prompt="Months: ")
inspectaMonth = strsplit(inspectaMonth,"[[:space:]]")
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
for (j in inspectaMonth){
MONTHkrill = dplyr::filter(krillYEAR,grepl(paste0("-",j,"-"),date.YMD))
MONTHsum = sum(MONTHkrill$Lipids,na.rm=TRUE)
MONTHmean = MONTHsum/length(MONTHkrill$date.YMD)
MONTHsd = sd(MONTHkrill$Lipids,na.rm=TRUE)
seasonalLipids = rbind(seasonalLipids,c(i,MONTHmean,j,MONTHsd))
}
}
inspectaMonth = inspectaMonth$
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
for (j in inspectaMonth){
MONTHkrill = dplyr::filter(krillYEAR,grepl(paste0("-",j,"-"),date.YMD))
MONTHsum = sum(MONTHkrill$Lipids,na.rm=TRUE)
MONTHmean = MONTHsum/length(MONTHkrill$date.YMD)
MONTHsd = sd(MONTHkrill$Lipids,na.rm=TRUE)
seasonalLipids = rbind(seasonalLipids,c(i,MONTHmean,j,MONTHsd))
}
}
class(j)
inspectaMonth = unlist(inspectaMonth)
seasonalLipids = data.frame()
inspectaMonth = readline(prompt="Months: ") %<%
strsplit(inspectaMonth,"[[:space:]]") %<%
unlist(inspectaMonth)
inspectaMonth = readline(prompt="Months: ") %>%
strsplit(inspectaMonth,"[[:space:]]") %>%
unlist(inspectaMonth)
remove(inspectaMonth)
inspectaMonth = readline(prompt="Months: ") %>%
strsplit(inspectaMonth,"[[:space:]]") %>%
unlist(inspectaMonth)
inspectaMonth = readline(prompt="Months: ") %>%
strsplit("[[:space:]]") %>%
unlist()
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1)
krill = rename(krill, Lipids=GasChromatography_FattyAcidProfile_TotalPUFA_Omega3)
krill = rename(krill, Weight=RawKrill_Weight_g)
krill = rename(krill, Size=RawKrill_Size_mm)
krill[c("Date","Lipids","Size","Weight")] = sapply(krill[c("Date","Lipids","Size","Weight")],as.numeric)
krill$date.YMD = as.character(janitor::excel_numeric_to_date(krill$Date))
years = c('2011','2012','2013','2014','2015','2016','2017','2018','2019','2020','2021')
allMonthsLong = c("January","February","March","April","May","June","July","August","September","October","November","December")
inspectaMonth = readline(prompt="Months: ") %>%
strsplit("[[:space:]]") %>%
unlist()
seasonalLipids = data.frame()
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
for (j in inspectaMonth){
MONTHkrill = dplyr::filter(krillYEAR,grepl(paste0("-",j,"-"),date.YMD))
MONTHsum = sum(MONTHkrill$Lipids,na.rm=TRUE)
MONTHmean = MONTHsum/length(MONTHkrill$date.YMD)
MONTHsd = sd(MONTHkrill$Lipids,na.rm=TRUE)
seasonalLipids = rbind(seasonalLipids,c(i,MONTHmean,j,MONTHsd))
}
}
colnames(seasonalLipids) = c("Year","Lipids","Month","SD")
seasonalLipids$Lipids = as.numeric(seasonalLipids$Lipids)
seasonalLipids$Month = as.factor(seasonalLipids$Month)
seasonalLipids$SD = as.numeric(seasonalLipids$SD)
seasonalLipids[seasonalLipids==0] = NA
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_discrete(labels=allMonthsLong[as.numeric(inspectaMonth)]) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Mean omega-3 Content of Krill Stomachs") +
labs(y="Mean Omega-3 Content (mg)")
krillCocktail
inspectaMonth = readline(prompt="Months: ") %>%
strsplit("[[:space:]]") %>%
unlist()
seasonalLipids = data.frame()
for (i in years){
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD)) #Filter into one year, since I need to record the year
for (j in inspectaMonth){
MONTHkrill = dplyr::filter(krillYEAR,grepl(paste0("-",j,"-"),date.YMD))
MONTHsum = sum(MONTHkrill$Lipids,na.rm=TRUE)
MONTHmean = MONTHsum/length(MONTHkrill$date.YMD)
MONTHsd = sd(MONTHkrill$Lipids,na.rm=TRUE)
seasonalLipids = rbind(seasonalLipids,c(i,MONTHmean,j,MONTHsd))
}
}
colnames(seasonalLipids) = c("Year","Lipids","Month","SD")
seasonalLipids$Lipids = as.numeric(seasonalLipids$Lipids)
seasonalLipids$Month = as.factor(seasonalLipids$Month)
seasonalLipids$SD = as.numeric(seasonalLipids$SD)
seasonalLipids[seasonalLipids==0] = NA
krillCocktail = ggplot(seasonalLipids,aes(x=Year,y=Lipids,fill=Month)) +
geom_bar(stat="identity",position=position_dodge(0.9)) +
scale_fill_discrete(labels=allMonthsLong[as.numeric(inspectaMonth)]) +
geom_errorbar(aes(ymin=Lipids,ymax=Lipids+SD),position=position_dodge(0.9),width=0.2) +
ggtitle("Mean omega-3 Content of Krill Stomachs") +
labs(y="Mean Omega-3 Content (mg)")
krillCocktail
library(rmarkdown)
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1)
library(pacman)
pacman::p_load(xlsx2)
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1)
install.packages("xlsx2")
install.packages("xlsx2",type="source")
library(pacman)
pacman::p_load(xlsx)
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1)
# Krill prerequisites
library(pacman)
source("prerequisites.R")
#Testing with just one year (prior to loop testing) ####
krill2013 = dplyr::filter(krill,grepl(2013,date.YMD)) #Filters the whole data set to only use one year; this one is 2013
for (j in krill2013$date.YMD){ #Extracts the month from each date, so we can easily differentiate by month
krill2013$specMonth=(stri_sub(krill2013$date.YMD,6,7))
}
remove(monthlyLipids)
monthlyLipids = data.frame() #New data frame to put the monthly lipid data into
krill_pal = hue_pal()(12)
monthNums = c("01","02","03","04","05","06","07","08","09","10","11","12")
for (u in monthNums){
tempMonth = dplyr::filter(krill2013,grepl(u,specMonth))
monthSum = sum(tempMonth$Lipids,na.rm=TRUE)
monthMean = monthSum/length(tempMonth$specMonth)
if (((is.nan(monthMean)==TRUE|(monthMean==0)==TRUE))==TRUE){
monthlyLipids = rbind(monthlyLipids,c(0,u,2013))
krill_pal[as.numeric(u)] = "#454545"
} else {
monthlyLipids = rbind(monthlyLipids,c(monthMean,u,2013))}
}
colnames(monthlyLipids) = c("lipidMean","Month","Year")
monthlyLipids$lipidMean = as.numeric(monthlyLipids$lipidMean)
monthlyLipids$Month = as.factor(monthlyLipids$Month)
monthlyLipids$Year = as.character(monthlyLipids$Year)
pieTitle = expression(paste("Mean Monthly Lipid Content of ", italic("Euphausia superba"), ", 2013"))
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",width=1,color="white") +
coord_polar("y",start=0) +
geom_text(aes(y = ypos, label = as.character(lipidMean)), color = "white", size=6) +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
ggtitle(pieTitle)
krillPie
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",width=1,color="white") +
coord_polar("y",start=0) +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
ggtitle(pieTitle)
krillPie
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",width=1,color="white") +
coord_polar("y",start=0,direction=-1,clip="off") +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
ggtitle(pieTitle)
krillPie
install.packages("knitr")
install.packages("knitr")
library(knitr)
View(krill)
library(pacman)
pacman::p_load(xlsx,knitr,dplyr)
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1)
krill = rename(krill, Lipids=GasChromatography_FattyAcidProfile_TotalPUFA_Omega3)
krill = rename(krill, Weight=RawKrill_Weight_g)
krill = rename(krill, Size=RawKrill_Size_mm)
krill4disp = dplyr::filter(krill,grepl(Size>0))
library(pacman)
pacman::p_load(xlsx,knitr,dplyr)
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1)
krill = rename(krill, Lipids=GasChromatography_FattyAcidProfile_TotalPUFA_Omega3)
krill = rename(krill, Weight=RawKrill_Weight_g)
krill = rename(krill, Size=RawKrill_Size_mm)
krill4disp = dplyr::filter(krill,Size>0))
library(pacman)
pacman::p_load(xlsx,knitr,dplyr)
krill = read.xlsx2("Large Lipid data.xlsx",sheetIndex=1)
krill = rename(krill, Lipids=GasChromatography_FattyAcidProfile_TotalPUFA_Omega3)
krill = rename(krill, Weight=RawKrill_Weight_g)
krill = rename(krill, Size=RawKrill_Size_mm)
krill4disp = dplyr::filter(krill,Size>0)
kable(head(krill4disp),"simple")
# Looop! ####
for (i in years){
print(i)
krill_pal = hue_pal()(12)
remove(krillYEAR,krillPie,tempMonth,labelPos)
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD))
for (j in krillYEAR$date.YMD){
krillYEAR$specMonth=(stri_sub(krillYEAR$date.YMD,6,7))
monthlyLipids = data.frame()
badMonth = c()
n=1
for (u in monthNums){
tempMonth = dplyr::filter(krillYEAR,grepl(u,specMonth))
monthSum = sum(tempMonth$Lipids,na.rm=TRUE)
monthMean = monthSum/length(tempMonth$specMonth)
if (((is.nan(monthMean)==TRUE|(monthMean==0)==TRUE))==TRUE){ # Surely there's an easier way to do this? Oh well...
monthlyLipids = rbind(monthlyLipids,c(0,u,i))
krill_pal[as.numeric(u)] = "#454545"
badMonth[n] = as.numeric(u)
n=n+1
} else {
monthlyLipids = rbind(monthlyLipids,c(monthMean,u,i))}
}
colnames(monthlyLipids) = c("lipidMean","Month","Year")
monthlyLipids$lipidMean = as.numeric(monthlyLipids$lipidMean)
monthlyLipids$Month = as.factor(monthlyLipids$Month)
monthlyLipids$Year = as.character(monthlyLipids$Year)
labelPos = monthlyLipids %>%
mutate(csum = rev(cumsum(rev(lipidMean))),
pos = lipidMean/2 + lead(csum, 1),
pos = if_else(is.na(pos), lipidMean/2, pos,))
labelPos$pos[badMonth] = NA
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",
width=1,
color="white") +
coord_polar("y",start=0,direction=-1,clip="off") +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
geom_label_repel(labelPos, mapping=aes(y=pos, label=paste0(round(lipidMean,digits=2),"mg")),
size = 6.5, nudge_x = 0.7, show.legend = FALSE, na.rm = TRUE) +
ggtitle(i,subtitle=paste(as.character(round((sum(krillYEAR$Lipids,na.rm=TRUE)/1000),digits=2)), "g total")) + theme(plot.title = element_text(size = 22, face = "bold"), plot.subtitle = element_text(size = 19.5), legend.key.height=unit(0.5,"cm"),legend.title=element_text(size=18,face="bold"),legend.text=element_text(size=17))
assign(paste0("krill",i),krillPie)
}
}
# Looop! ####
for (i in years){
print(i)
krill_pal = hue_pal()(12)
remove(krillYEAR,krillPie,tempMonth,labelPos)
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD))
for (j in krillYEAR$date.YMD){
krillYEAR$specMonth=(stri_sub(krillYEAR$date.YMD,6,7))
monthlyLipids = data.frame()
badMonth = c()
n=1
for (u in monthNums){
tempMonth = dplyr::filter(krillYEAR,grepl(u,specMonth))
monthSum = sum(tempMonth$Lipids,na.rm=TRUE)
monthMean = monthSum/length(tempMonth$specMonth)
if (((is.nan(monthMean)==TRUE|(monthMean==0)==TRUE))==TRUE){ # Surely there's an easier way to do this? Oh well...
monthlyLipids = rbind(monthlyLipids,c(0,u,i))
krill_pal[as.numeric(u)] = "#454545"
badMonth[n] = as.numeric(u)
n=n+1
} else {
monthlyLipids = rbind(monthlyLipids,c(monthMean,u,i))}
}
colnames(monthlyLipids) = c("lipidMean","Month","Year")
monthlyLipids$lipidMean = as.numeric(monthlyLipids$lipidMean)
monthlyLipids$Month = as.factor(monthlyLipids$Month)
monthlyLipids$Year = as.character(monthlyLipids$Year)
labelPos = monthlyLipids %>%
mutate(csum = rev(cumsum(rev(lipidMean))),
pos = lipidMean/2 + lead(csum, 1),
pos = if_else(is.na(pos), lipidMean/2, pos,))
labelPos$pos[badMonth] = NA
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",
width=1,
color="white") +
coord_polar("y",start=0,direction=-1,clip="off") +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
geom_label_repel(labelPos, mapping=aes(y=pos, label=paste0(round(lipidMean,digits=2),"mg")),
size = 6.5, nudge_x = 0.7, show.legend = FALSE, na.rm = TRUE) +
ggtitle(i,subtitle=paste(as.character(round((sum(krillYEAR$Lipids,na.rm=TRUE)/1000),digits=2)), "g total")) + theme(plot.title = element_text(size = 22, face = "bold"), plot.subtitle = element_text(size = 19.5), legend.key.height=unit(0.5,"cm"),legend.title=element_text(size=18,face="bold"),legend.text=element_text(size=17))
assign(paste0("krill",i),krillPie)
}
}
# 14/09/2022 | Pie charts for each year to illustrate mean monthly lipid content
#Prerequisites ####
source("prerequisites.R")
krill_pal = hue_pal()(12)
# Looop! ####
for (i in years){
print(i)
krill_pal = hue_pal()(12)
remove(krillYEAR,krillPie,tempMonth,labelPos)
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD))
for (j in krillYEAR$date.YMD){
krillYEAR$specMonth=(stri_sub(krillYEAR$date.YMD,6,7))
monthlyLipids = data.frame()
badMonth = c()
n=1
for (u in monthNums){
tempMonth = dplyr::filter(krillYEAR,grepl(u,specMonth))
monthSum = sum(tempMonth$Lipids,na.rm=TRUE)
monthMean = monthSum/length(tempMonth$specMonth)
if (((is.nan(monthMean)==TRUE|(monthMean==0)==TRUE))==TRUE){ # Surely there's an easier way to do this? Oh well...
monthlyLipids = rbind(monthlyLipids,c(0,u,i))
krill_pal[as.numeric(u)] = "#454545"
badMonth[n] = as.numeric(u)
n=n+1
} else {
monthlyLipids = rbind(monthlyLipids,c(monthMean,u,i))}
}
colnames(monthlyLipids) = c("lipidMean","Month","Year")
monthlyLipids$lipidMean = as.numeric(monthlyLipids$lipidMean)
monthlyLipids$Month = as.factor(monthlyLipids$Month)
monthlyLipids$Year = as.character(monthlyLipids$Year)
labelPos = monthlyLipids %>%
mutate(csum = rev(cumsum(rev(lipidMean))),
pos = lipidMean/2 + lead(csum, 1),
pos = if_else(is.na(pos), lipidMean/2, pos,))
labelPos$pos[badMonth] = NA
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",
width=1,
color="white") +
coord_polar("y",start=0,direction=-1,clip="off") +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
geom_label_repel(labelPos, mapping=aes(y=pos, label=paste0(round(lipidMean,digits=2),"mg")),
size = 6.5, nudge_x = 0.7, show.legend = FALSE, na.rm = TRUE) +
ggtitle(i,subtitle=paste(as.character(round((sum(krillYEAR$Lipids,na.rm=TRUE)/1000),digits=2)), "g total")) + theme(plot.title = element_text(size = 22, face = "bold"), plot.subtitle = element_text(size = 19.5), legend.key.height=unit(0.5,"cm"),legend.title=element_text(size=18,face="bold"),legend.text=element_text(size=17))
assign(paste0("krill",i),krillPie)
}
}
# Combined plot ####
pieFestival = plot_grid(krill2011,krill2012,krill2013,krill2014,krill2015,krill2016,krill2017,krill2018,krill2019,krill2020,krill2021)
title = ggdraw() +
draw_label("Monthly Mean Omega-3 Content of Krill Stomachs (2011-2022)",
fontface = "bold",
size = 35,
x = 0,
hjust = 0) +
theme(plot.margin = margin(0,0,0,7))
plot_grid(
title,pieFestival,
ncol = 1,
rel_heights = c(0.1,1))
title = ggdraw() +
draw_label("Monthly Mean Omega-3 Content of Krill Stomachs (2011-2022)",
fontface = "bold",
size = 25,
x = 0,
hjust = 0) +
theme(plot.margin = margin(0,0,0,7))
plot_grid(
title,pieFestival,
ncol = 1,
rel_heights = c(0.1,1))
# Looop! ####
for (i in years){
print(i)
krill_pal = hue_pal()(12)
remove(krillYEAR,krillPie,tempMonth,labelPos)
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD))
for (j in krillYEAR$date.YMD){
krillYEAR$specMonth=(stri_sub(krillYEAR$date.YMD,6,7))
monthlyLipids = data.frame()
badMonth = c()
n=1
for (u in monthNums){
tempMonth = dplyr::filter(krillYEAR,grepl(u,specMonth))
monthSum = sum(tempMonth$Lipids,na.rm=TRUE)
monthMean = monthSum/length(tempMonth$specMonth)
if (((is.nan(monthMean)==TRUE|(monthMean==0)==TRUE))==TRUE){ # Surely there's an easier way to do this? Oh well...
monthlyLipids = rbind(monthlyLipids,c(0,u,i))
krill_pal[as.numeric(u)] = "#454545"
badMonth[n] = as.numeric(u)
n=n+1
} else {
monthlyLipids = rbind(monthlyLipids,c(monthMean,u,i))}
}
colnames(monthlyLipids) = c("lipidMean","Month","Year")
monthlyLipids$lipidMean = as.numeric(monthlyLipids$lipidMean)
monthlyLipids$Month = as.factor(monthlyLipids$Month)
monthlyLipids$Year = as.character(monthlyLipids$Year)
labelPos = monthlyLipids %>%
mutate(csum = rev(cumsum(rev(lipidMean))),
pos = lipidMean/2 + lead(csum, 1),
pos = if_else(is.na(pos), lipidMean/2, pos,))
labelPos$pos[badMonth] = NA
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",
width=1,
color="white") +
coord_polar("y",start=0,direction=-1,clip="off") +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
geom_label_repel(labelPos, mapping=aes(y=pos, label=paste0(round(lipidMean,digits=2),"mg")),
size = 3, nudge_x = 0.7, show.legend = FALSE, na.rm = TRUE) +
ggtitle(i,subtitle=paste(as.character(round((sum(krillYEAR$Lipids,na.rm=TRUE)/1000),digits=2)), "g total")) + theme(plot.title = element_text(size = 16.5, face = "bold"), plot.subtitle = element_text(size = 15), legend.key.height=unit(0.5,"cm"),legend.title=element_text(size=18,face="bold"),legend.text=element_text(size=17))
assign(paste0("krill",i),krillPie)
}
}
# Combined plot ####
pieFestival = plot_grid(krill2011,krill2012,krill2013,krill2014,krill2015,krill2016,krill2017,krill2018,krill2019,krill2020,krill2021)
title = ggdraw() +
draw_label("Monthly Mean Omega-3 Content of Krill Stomachs (2011-2022)",
fontface = "bold",
size = 17.5,
x = 0,
hjust = 0) +
theme(plot.margin = margin(0,0,0,7))
plot_grid(
title,pieFestival,
ncol = 1,
rel_heights = c(0.1,1))
gc()
gc()
# 14/09/2022 | Pie charts for each year to illustrate mean monthly lipid content
#Prerequisites ####
source("prerequisites.R")
# Looop! ####
for (i in years){
print(i)
krill_pal = hue_pal()(12)
remove(krillYEAR,krillPie,tempMonth,labelPos)
krillYEAR = dplyr::filter(krill,grepl(as.character(i),date.YMD))
for (j in krillYEAR$date.YMD){
krillYEAR$specMonth=(stri_sub(krillYEAR$date.YMD,6,7))
monthlyLipids = data.frame()
badMonth = c()
n=1
for (u in monthNums){
tempMonth = dplyr::filter(krillYEAR,grepl(u,specMonth))
monthSum = sum(tempMonth$Lipids,na.rm=TRUE)
monthMean = monthSum/length(tempMonth$specMonth)
if (((is.nan(monthMean)==TRUE|(monthMean==0)==TRUE))==TRUE){ # Surely there's an easier way to do this? Oh well...
monthlyLipids = rbind(monthlyLipids,c(0,u,i))
krill_pal[as.numeric(u)] = "#454545"
badMonth[n] = as.numeric(u)
n=n+1
} else {
monthlyLipids = rbind(monthlyLipids,c(monthMean,u,i))}
}
colnames(monthlyLipids) = c("lipidMean","Month","Year")
monthlyLipids$lipidMean = as.numeric(monthlyLipids$lipidMean)
monthlyLipids$Month = as.factor(monthlyLipids$Month)
monthlyLipids$Year = as.character(monthlyLipids$Year)
labelPos = monthlyLipids %>%
mutate(csum = rev(cumsum(rev(lipidMean))),
pos = lipidMean/2 + lead(csum, 1),
pos = if_else(is.na(pos), lipidMean/2, pos,))
labelPos$pos[badMonth] = NA
krillPie = ggplot(monthlyLipids,aes(x=Year,y=lipidMean,fill=Month)) +
geom_bar(stat="identity",
width=1,
color="white") +
coord_polar("y",start=0,direction=-1,clip="off") +
theme_void() +
scale_fill_manual(labels=c(allMonths),values=krill_pal) +
geom_label_repel(labelPos, mapping=aes(y=pos, label=paste0(round(lipidMean,digits=2),"mg")),
size = 3, nudge_x = 0.7, show.legend = FALSE, na.rm = TRUE) +
ggtitle(i,subtitle=paste(as.character(round((sum(krillYEAR$Lipids,na.rm=TRUE)/1000),digits=2)), "g total")) + theme(plot.title = element_text(size = 16.5, face = "bold"), plot.subtitle = element_text(size = 15),legend.title=element_text(size=8.5,face="bold"),legend.text=element_text(size=8))
assign(paste0("krill",i),krillPie)
}
}
pieFestival = plot_grid(krill2011,krill2012,krill2013,krill2014,krill2015,krill2016,krill2017,krill2018,krill2019,krill2020,krill2021)
title = ggdraw() +
draw_label("Monthly Mean Omega-3 Content of Krill Stomachs (2011-2022)",
fontface = "bold",
size = 17.5,
x = 0,
hjust = 0) +
theme(plot.margin = margin(0,0,0,7))
plot_grid(
title,pieFestival,
ncol = 1,
rel_heights = c(0.1,1))
save(krill2011,krill2012,krill2013,krill2014,krill2015,krill2016,krill2017,krill2018,krill2019,krill2020,krill2021, file = "krillOBJECTS.RData")
save(krill2011,krill2012,krill2013,krill2014,krill2015,krill2016,krill2017,krill2018,krill2019,krill2020,krill2021, file = "krillOBJECTS.RData")
